<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{giftorder/layout}">
<head>
    <title>μ„ λ¬Όμ„ΈνΈ μ„ νƒ</title>
</head>
<body>
<div layout:fragment="content">
    <div class="customer-info">
        <span th:text="${customer.name}">ν™κΈΈλ™</span>λ‹ ν™μν•©λ‹λ‹¤!
        (<span th:text="${customer.phone}">010-1234-5678</span>)
    </div>

    <div class="content">
        <div class="products">
            <!-- κ°λΉ„ μ„ λ¬Όμ„ΈνΈ -->
            <div class="product-card">
                <img src="/images/galbi-set.jpg" alt="κ°λΉ„ μ„ λ¬Όμ„ΈνΈ" class="product-image"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="product-image-placeholder" style="display:none;">π¥©</div>

                <div class="product-info">
                    <div class="product-name">ν”„λ¦¬λ―Έμ—„ κ°λΉ„ μ„ λ¬Όμ„ΈνΈ</div>
                    <div class="product-description">μµκ³ κΈ‰ ν•μ° κ°λΉ„λ΅ λ§λ“  ν”„λ¦¬λ―Έμ—„ μ„ λ¬Όμ„ΈνΈμ…λ‹λ‹¤. λ…μ κ³Ό νΉλ³„ν• λ‚  μ„ λ¬Όλ΅ μ™„λ²½ν•©λ‹λ‹¤.</div>
                    <div class="product-price">50,000μ›</div>

                    <!-- μ΄λ―Έ μ¥λ°”κµ¬λ‹μ— λ‹΄κΈ΄ μλ‰ ν‘μ‹ -->
                    <div th:if="${cart.galbiQuantity > 0}" class="cart-status">
                        π›’ μ¥λ°”κµ¬λ‹μ— <span th:text="${cart.galbiQuantity}">1</span>κ° λ‹΄κΉ€
                    </div>

                    <div class="quantity-controls">
                        <span class="quantity-label">μ¶”κ°€ μλ‰</span>
                        <div class="quantity-selector">
                            <button type="button" class="quantity-btn" onclick="decreaseQuantity('galbi')">-</button>
                            <span class="quantity-display" id="galbi-quantity">0</span>
                            <button type="button" class="quantity-btn" onclick="increaseQuantity('galbi')">+</button>
                        </div>
                    </div>

                    <button class="add-to-cart" onclick="addToCart('galbi')" id="galbi-add-btn" disabled>
                        μ¥λ°”κµ¬λ‹μ— μ¶”κ°€
                    </button>
                </div>
            </div>

            <!-- μ¤νΈ μ„ λ¬Όμ„ΈνΈ -->
            <div class="product-card">
                <img src="/images/spam-set.jpg" alt="μ¤νΈ μ„ λ¬Όμ„ΈνΈ" class="product-image"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="product-image-placeholder" style="display:none;">π¥«</div>

                <div class="product-info">
                    <div class="product-name">ν”„λ¦¬λ―Έμ—„ μ¤νΈ μ„ λ¬Όμ„ΈνΈ</div>
                    <div class="product-description">μ •μ„±μ¤λ½κ² μ„ λ³„ν• ν”„λ¦¬λ―Έμ—„ μ¤νΈ μ„ λ¬Όμ„ΈνΈμ…λ‹λ‹¤. μ‹¤μ©μ μ΄κ³  λ§›μλ” μ„ λ¬Όμ…λ‹λ‹¤.</div>
                    <div class="product-price">30,000μ›</div>

                    <!-- μ΄λ―Έ μ¥λ°”κµ¬λ‹μ— λ‹΄κΈ΄ μλ‰ ν‘μ‹ -->
                    <div th:if="${cart.spamQuantity > 0}" class="cart-status">
                        π›’ μ¥λ°”κµ¬λ‹μ— <span th:text="${cart.spamQuantity}">1</span>κ° λ‹΄κΉ€
                    </div>

                    <div class="quantity-controls">
                        <span class="quantity-label">μ¶”κ°€ μλ‰</span>
                        <div class="quantity-selector">
                            <button type="button" class="quantity-btn" onclick="decreaseQuantity('spam')">-</button>
                            <span class="quantity-display" id="spam-quantity">0</span>
                            <button type="button" class="quantity-btn" onclick="increaseQuantity('spam')">+</button>
                        </div>
                    </div>

                    <button class="add-to-cart" onclick="addToCart('spam')" id="spam-add-btn" disabled>
                        μ¥λ°”κµ¬λ‹μ— μ¶”κ°€
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="cart-footer">
        <div class="cart-info">
            μ¥λ°”κµ¬λ‹: <span id="cart-count" th:text="${cart.galbiQuantity + cart.spamQuantity}">0</span>κ° μƒν’
        </div>
        <button class="go-cart-btn"
                onclick="location.href='/cart'"
                id="cart-btn"
                th:disabled="${cart.isEmpty()}">
            μ¥λ°”κµ¬λ‹ λ³΄κΈ°
        </button>
    </div>
</div>

<script layout:fragment="scripts">
    // μ„λ²„μ—μ„ ν„μ¬ μ¥λ°”κµ¬λ‹ μƒνƒλ¥Ό κ°€μ Έμ™€μ„ μ΄κΈ°ν™”
    let cart = {
        galbi: /*[[${cart.galbiQuantity}]]*/ 0,
        spam: /*[[${cart.spamQuantity}]]*/ 0
    };
    let quantities = { galbi: 0, spam: 0 };

    console.log("νμ΄μ§€ λ΅λ“ μ‹ μ¥λ°”κµ¬λ‹ μƒνƒ:", cart);

    // νμ΄μ§€ λ΅λ“ μ‹ μ¥λ°”κµ¬λ‹ ν‘μ‹ μ—…λ°μ΄νΈ
    window.addEventListener('DOMContentLoaded', function() {
        updateCartDisplay();
    });

    function increaseQuantity(product) {
        if (quantities[product] < 20) {
            quantities[product]++;
            updateQuantityDisplay(product);
        }
    }

    function decreaseQuantity(product) {
        if (quantities[product] > 0) {
            quantities[product]--;
            updateQuantityDisplay(product);
        }
    }

    function updateQuantityDisplay(product) {
        document.getElementById(product + '-quantity').textContent = quantities[product];
        document.getElementById(product + '-add-btn').disabled = quantities[product] === 0;
    }

    function addToCart(product) {
        if (quantities[product] > 0) {
            cart[product] += quantities[product]; // κΈ°μ΅΄ μλ‰μ— μ¶”κ°€
            quantities[product] = 0;
            updateQuantityDisplay(product);
            updateCartDisplay();

            // μ„λ²„μ— μ¦‰μ‹ λ™κΈ°ν™”
            goToCart();
        }
    }

    function updateCartDisplay() {
        const totalItems = cart.galbi + cart.spam;
        document.getElementById('cart-count').textContent = totalItems;
        document.getElementById('cart-btn').disabled = totalItems === 0;
    }

    function goToCart() {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/cart';

        Object.keys(quantities).forEach(key => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key + 'Quantity';
            input.value = quantities[key];
            form.appendChild(input);
        });

        document.body.appendChild(form);
        form.submit();
    }
</script>
</body>
</html>