<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{giftorder/layout}">
<head>
    <title>ë°°ì†¡ì§€ ì…ë ¥</title>
    <th:block layout:fragment="extraHead">
        <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <div class="page-header">
        <button class="back-btn" onclick="history.back()">â†</button>
        <h1 class="page-title">ğŸšš ë°°ì†¡ì§€ ì…ë ¥</h1>
    </div>

    <div class="container">
        <!-- ì£¼ë¬¸ ìš”ì•½ -->
        <div class="order-summary">
            <div class="summary-title">ğŸ“¦ ì£¼ë¬¸ ìš”ì•½</div>

            <div class="summary-row" th:if="${cart.galbiQuantity > 0}">
                <span>ê°ˆë¹„ ì„ ë¬¼ì„¸íŠ¸ Ã— <span th:text="${cart.galbiQuantity}">1</span></span>
                <span th:text="${#numbers.formatInteger(cart.galbiQuantity * 50000, 0, 'COMMA')}">50,000</span>ì›
            </div>

            <div class="summary-row" th:if="${cart.spamQuantity > 0}">
                <span>ìŠ¤íŒ¸ ì„ ë¬¼ì„¸íŠ¸ Ã— <span th:text="${cart.spamQuantity}">1</span></span>
                <span th:text="${#numbers.formatInteger(cart.spamQuantity * 30000, 0, 'COMMA')}">30,000</span>ì›
            </div>

            <div class="summary-row summary-total">
                <span>ì´ ê²°ì œê¸ˆì•¡</span>
                <span th:text="${#numbers.formatInteger(cart.totalAmount, 0, 'COMMA')}">80,000</span>ì›
            </div>
        </div>

        <form th:action="@{/order/complete}" method="post" id="orderForm" th:object="${orderForm}">
            <!-- ë°›ëŠ” ì‚¬ëŒ ì •ë³´ -->
            <div class="form-section">
                <div class="section-title">ğŸ‘¤ ë°›ëŠ” ì‚¬ëŒ ì •ë³´</div>

                <div class="form-group">
                    <label for="recipientName">ë°›ëŠ” ì‚¬ëŒ <span class="required">*</span></label>
                    <input type="text" id="recipientName" th:field="*{recipientName}" required
                           placeholder="ë°›ëŠ” ë¶„ì˜ ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="recipientPhone">ì—°ë½ì²˜ <span class="required">*</span></label>
                    <input type="tel" id="recipientPhone" th:field="*{recipientPhone}" required
                           placeholder="010-1234-5678" pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}">
                </div>
            </div>

            <!-- ë°°ì†¡ì§€ ì •ë³´ -->
            <div class="form-section">
                <div class="section-title">ğŸ  ë°°ì†¡ì§€ ì •ë³´</div>

                <div class="form-group">
                    <label for="zipcode">ìš°í¸ë²ˆí˜¸ <span class="required">*</span></label>
                    <div class="address-search">
                        <input type="text" id="zipcode" th:field="*{zipcode}" class="address-input"
                               readonly placeholder="ìš°í¸ë²ˆí˜¸" required>
                        <button type="button" class="search-btn" onclick="searchAddress()">
                            ì£¼ì†Œ ê²€ìƒ‰
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="address">ì£¼ì†Œ <span class="required">*</span></label>
                    <input type="text" id="address" th:field="*{address}" class="address-readonly"
                           readonly placeholder="ì£¼ì†Œ ê²€ìƒ‰ì„ í´ë¦­í•˜ì„¸ìš”" required>
                </div>

                <div class="form-group">
                    <label for="detailAddress">ìƒì„¸ì£¼ì†Œ <span class="required">*</span></label>
                    <input type="text" id="detailAddress" th:field="*{detailAddress}" required
                           placeholder="ë™/í˜¸ìˆ˜, ê±´ë¬¼ëª… ë“±ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="deliveryMemo">ë°°ì†¡ ë©”ëª¨</label>
                    <textarea id="deliveryMemo" th:field="*{deliveryMemo}"
                              placeholder="ë°°ì†¡ ì‹œ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
            </div>

            <button type="submit" class="order-btn" id="submitBtn">
                ğŸ ì´ <span th:text="${#numbers.formatInteger(cart.totalAmount, 0, 'COMMA')}">80,000</span>ì› ì£¼ë¬¸í•˜ê¸°
            </button>
        </form>
    </div>
</div>

<script layout:fragment="scripts">
    let formValid = false;

    function searchAddress() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('zipcode').value = data.zonecode;
                document.getElementById('address').value = data.address;
                document.getElementById('detailAddress').focus();
                validateForm();
            }
        }).open();
    }

    function validateForm() {
        const form = document.getElementById('orderForm');
        const inputs = form.querySelectorAll('input[required]');
        let allValid = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                allValid = false;
            }
        });

        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = !allValid;

        // ìŠ¤íƒ€ì¼ ì§ì ‘ ì ìš©
        if (allValid) {
            submitBtn.style.backgroundColor = '#28a745';
            submitBtn.style.cursor = 'pointer';
            submitBtn.style.opacity = '1';
        } else {
            submitBtn.style.backgroundColor = '#ccc';
            submitBtn.style.cursor = 'not-allowed';
            submitBtn.style.opacity = '0.6';
        }

        console.log('Form valid:', allValid);
    }

    // ëª¨ë“  inputì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('orderForm');
        const inputs = form.querySelectorAll('input, textarea');

        inputs.forEach(input => {
            input.addEventListener('input', validateForm);
            input.addEventListener('change', validateForm);
        });

        // ì´ˆê¸° ê²€ì¦
        validateForm();
    });

    document.getElementById('orderForm').addEventListener('submit', function(e) {
        if (!confirm('ì£¼ë¬¸ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            e.preventDefault();
        }
    });
</script>
</body>
</html>